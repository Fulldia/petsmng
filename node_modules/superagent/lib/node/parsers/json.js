<<<<<<< HEAD
'use strict';
=======
>>>>>>> 34f03bf259ef6d5f22c22e47eca085eaa7ac4538

module.exports = function parseJSON(res, fn){
  res.text = '';
  res.setEncoding('utf8');
<<<<<<< HEAD
  res.on('data', chunk => {
    res.text += chunk;
  });
  res.on('end', () => {
=======
  res.on('data', function(chunk){ res.text += chunk;});
  res.on('end', function(){
>>>>>>> 34f03bf259ef6d5f22c22e47eca085eaa7ac4538
    try {
      var body = res.text && JSON.parse(res.text);
    } catch (e) {
      var err = e;
      // issue #675: return the raw response if the response parsing fails
      err.rawResponse = res.text || null;
      // issue #876: return the http status code if the response parsing fails
      err.statusCode = res.statusCode;
    } finally {
      fn(err, body);
    }
  });
};
