if (global.GENTLY) require = GENTLY.hijack(require);

var Buffer = require('buffer').Buffer;

<<<<<<< HEAD
function JSONParser(parent) {
  this.parent = parent;
  this.chunks = [];
=======
function JSONParser() {
  this.data = new Buffer('');
>>>>>>> 34f03bf259ef6d5f22c22e47eca085eaa7ac4538
  this.bytesWritten = 0;
}
exports.JSONParser = JSONParser;

<<<<<<< HEAD
JSONParser.prototype.write = function(buffer) {
  this.bytesWritten += buffer.length;
  this.chunks.push(buffer);
=======
JSONParser.prototype.initWithLength = function(length) {
  this.data = new Buffer(length);
};

JSONParser.prototype.write = function(buffer) {
  if (this.data.length >= this.bytesWritten + buffer.length) {
    buffer.copy(this.data, this.bytesWritten);
  } else {
    this.data = Buffer.concat([this.data, buffer]);
  }
  this.bytesWritten += buffer.length;
>>>>>>> 34f03bf259ef6d5f22c22e47eca085eaa7ac4538
  return buffer.length;
};

JSONParser.prototype.end = function() {
  try {
<<<<<<< HEAD
    var fields = JSON.parse(Buffer.concat(this.chunks));
    for (var field in fields) {
      this.onField(field, fields[field]);
    }
  } catch (e) {
    this.parent.emit('error', e);
  }
=======
    var fields = JSON.parse(this.data.toString('utf8'));
    for (var field in fields) {
      this.onField(field, fields[field]);
    }
  } catch (e) {}
>>>>>>> 34f03bf259ef6d5f22c22e47eca085eaa7ac4538
  this.data = null;

  this.onEnd();
};
